# 🤖 P2P Trading Bot для Rust скинов - Полное руководство

## 📋 Что это за проект?

Автоматизированный бот для трейдинга скинов игры Rust между тремя площадками:
- **TradeIt.gg** - основной баланс ~$28
- **DMarket** - баланс ~$1.10  
- **Loot.Farm** - баланс $0

Бот автоматически:
1. Анализирует цены через таблицу Pulse
2. Находит предметы с наибольшим СПРЕДОМ (разницей цен)
3. Покупает/обменивает на одной площадке
4. Продает/обменивает на другой с профитом
5. Автоматически подтверждает ВСЕ трейды через Steam Guard

---

## 🔄 Как работает трейдинг (подробная схема)

```
┌─────────────────────────────────────────────────────────────────────────┐
│                           ЦИКЛ ТРЕЙДИНГА                                 │
└─────────────────────────────────────────────────────────────────────────┘

ЭТАП 1: АНАЛИЗ
═══════════════
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│  TradeIt.gg │     │   DMarket   │     │  Loot.Farm  │
│   $28.00    │     │   $1.10     │     │   $0.00     │
└──────┬──────┘     └──────┬──────┘     └──────┬──────┘
       │                   │                   │
       └───────────────────┴───────────────────┘
                           │
                           ▼
              ┌────────────────────────┐
              │      PULSE API         │
              │  (Сравнение цен)       │
              │                        │
              │  Комбинации:           │
              │  • TradeIt ↔ DMarket   │
              │  • TradeIt ↔ LootFarm  │
              │  • DMarket ↔ LootFarm  │
              └───────────┬────────────┘
                          │
                          ▼
              ┌────────────────────────┐
              │   ВЫБОР ЛУЧШЕГО        │
              │   СПРЕДА               │
              │                        │
              │   Пример:              │
              │   "Ace Door"           │
              │   DMarket: $0.92       │
              │   LootFarm: $1.35      │
              │   Спред: +46.7%        │
              └───────────┬────────────┘
                          │
                          ▼

ЭТАП 2: ПОКУПКА
═══════════════
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                          │
│   Если источник = DMarket (есть API):                                   │
│   ┌──────────────────────────────────────────────────────────────────┐  │
│   │  1. POST /exchange/v1/offers-buy - покупка предмета              │  │
│   │  2. POST /exchange/v1/withdraw-assets - вывод в Steam            │  │
│   │  3. Ожидание трейд-оффера от бота DMarket                        │  │
│   └──────────────────────────────────────────────────────────────────┘  │
│                                                                          │
│   Если источник = LootFarm (веб-автоматизация):                         │
│   ┌──────────────────────────────────────────────────────────────────┐  │
│   │  1. Открыть https://loot.farm                                    │  │
│   │  2. Выбрать свой предмет (левая панель)                          │  │
│   │  3. Найти предмет бота по поиску (правая панель)                 │  │
│   │  4. Нажать "Обменять"                                            │  │
│   │  5. Ожидание трейд-оффера от бота LootFarm                       │  │
│   └──────────────────────────────────────────────────────────────────┘  │
│                                                                          │
│   Если источник = TradeIt.gg (веб-автоматизация):                       │
│   ┌──────────────────────────────────────────────────────────────────┐  │
│   │  1. Открыть https://tradeit.gg/ru/rust/trade                     │  │
│   │  2. Найти предмет по поиску                                      │  │
│   │  3. Добавить в корзину                                           │  │
│   │  4. Оформить покупку/обмен                                       │  │
│   │  5. Ожидание трейд-оффера от бота TradeIt                        │  │
│   └──────────────────────────────────────────────────────────────────┘  │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
                          │
                          ▼

ЭТАП 3: АВТОПОДТВЕРЖДЕНИЕ STEAM GUARD
═════════════════════════════════════
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                          │
│   ┌──────────────────┐                                                  │
│   │   maFile данные  │                                                  │
│   │                  │                                                  │
│   │  shared_secret   │──▶ Генерация 5-значного кода (для логина)       │
│   │  identity_secret │──▶ Генерация confirmation_key (для трейдов)     │
│   │  device_id       │──▶ Идентификатор устройства                     │
│   └──────────────────┘                                                  │
│                                                                          │
│   Алгоритм подтверждения:                                               │
│   ┌──────────────────────────────────────────────────────────────────┐  │
│   │  1. GET /mobileconf/getlist - получить список ожидающих          │  │
│   │     Параметры: p=device_id, a=steam_id, k=conf_key, t=timestamp  │  │
│   │                                                                   │  │
│   │  2. Для каждого подтверждения:                                   │  │
│   │     GET /mobileconf/ajaxop?op=allow&cid=XXX&ck=YYY               │  │
│   │                                                                   │  │
│   │  3. Проверка успеха: {"success": true}                           │  │
│   └──────────────────────────────────────────────────────────────────┘  │
│                                                                          │
│   ⚡ Мониторинг каждые 5-10 секунд                                      │
│   ✅ Автоматическое подтверждение ВСЕХ трейдов от ботов площадок       │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
                          │
                          ▼

ЭТАП 4: ОЖИДАНИЕ ПРЕДМЕТА
═════════════════════════
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                          │
│   После подтверждения трейда:                                           │
│   • Предмет появляется в Steam инвентаре                                │
│   • Проверка через Steam API или веб-страницу                           │
│   • Обычно занимает 10-60 секунд                                        │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
                          │
                          ▼

ЭТАП 5: ПРОДАЖА/ОБМЕН НА ДРУГОЙ ПЛОЩАДКЕ
════════════════════════════════════════
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                          │
│   Если цель = DMarket:                                                  │
│   ┌──────────────────────────────────────────────────────────────────┐  │
│   │  1. POST /marketplace-api/v1/deposit-assets - депозит на DMarket │  │
│   │  2. Подтверждение трейда через Steam Guard                       │  │
│   │  3. POST /marketplace-api/v1/user-offers/create - выставить      │  │
│   │     на продажу по цене из таблицы Pulse                          │  │
│   └──────────────────────────────────────────────────────────────────┘  │
│                                                                          │
│   Если цель = LootFarm:                                                 │
│   ┌──────────────────────────────────────────────────────────────────┐  │
│   │  1. Обновить инвентарь на сайте                                  │  │
│   │  2. Выбрать полученный предмет                                   │  │
│   │  3. Найти предмет для обмена (который дороже на DMarket)         │  │
│   │  4. Создать обмен                                                │  │
│   │  5. Подтвердить через Steam Guard                                │  │
│   └──────────────────────────────────────────────────────────────────┘  │
│                                                                          │
│   Если цель = TradeIt.gg:                                               │
│   ┌──────────────────────────────────────────────────────────────────┐  │
│   │  1. Аналогично LootFarm через веб-интерфейс                      │  │
│   └──────────────────────────────────────────────────────────────────┘  │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
                          │
                          ▼

ЭТАП 6: ПРОФИТ!
═══════════════
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                          │
│   Пример круга:                                                         │
│   ┌──────────────────────────────────────────────────────────────────┐  │
│   │  1. Купил "Ace Door" на DMarket за $0.92                         │  │
│   │  2. Обменял на LootFarm (там он стоит $1.35)                     │  │
│   │  3. Получил "Adobe Barricade" который на DMarket стоит $1.40     │  │
│   │  4. Продал на DMarket за $1.40                                   │  │
│   │                                                                   │  │
│   │  Профит: $1.40 - $0.92 - комиссии ≈ $0.35-0.40 (+40%)           │  │
│   └──────────────────────────────────────────────────────────────────┘  │
│                                                                          │
│   📊 Уведомление в Telegram                                             │
│   🔄 Повтор цикла                                                       │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 🔑 Ключевые данные проекта

### API ключи
| Сервис | Ключ |
|--------|------|
| Pulse API | `btpx0x70uq4tqqouw82zsgo4th8bbvc2` |
| DMarket Public | `29e8f8de3f4c9fd27a372b310935f1894ed2f649076308b4a65e209c8a920463` |
| DMarket Private | `117a339181a1a7e2beaee49b6a82b38ad022461fa4cf7cea60b9f30d068978c429e8f8de3f4c9fd27a372b310935f1894ed2f649076308b4a65e209c8a920463` |
| Steam API | `A1212401D06E9D87970B68F57BDA259` |
| Telegram Bot | `8441168945:AAFjcsas9wObkYwh2TQhLaekj5agix2aBCk` |

### Steam аккаунт
| Параметр | Значение |
|----------|----------|
| Username | `mz1r0y0viv2blnxo` |
| SteamID | `76561199113719186` |
| shared_secret | `4jPw7S9tfkaHtrxiGEQAQtMAPv0=` |
| identity_secret | `OXVdKtNH+SnnTjYycJU/n47O1Wk=` |
| device_id | `android:8f86487a-e48b-4bab-b5a0-93cd9e53e840` |

### Текущие балансы
| Площадка | Баланс |
|----------|--------|
| TradeIt.gg | ~$28 |
| DMarket | ~$1.10 |
| Loot.Farm | $0 |

---

## 📁 Структура проекта

```
rust-p2p-bot/
├── config/
│   ├── settings.json      # Настройки бота
│   └── mafile.json        # Данные Steam Guard
├── src/
│   ├── steam_guard.py     # Автоподтверждение трейдов
│   ├── pulse_api.py       # Работа с Pulse API
│   ├── dmarket_api.py     # Работа с DMarket API
│   ├── lootfarm.py        # Веб-автоматизация Loot.Farm
│   ├── tradeit.py         # Веб-автоматизация TradeIt.gg
│   ├── trading_logic.py   # Основная логика трейдинга
│   └── telegram_bot.py    # Telegram бот
├── logs/                  # Логи операций
├── main.py               # Точка входа
└── requirements.txt      # Зависимости
```

---

## 📚 Важные файлы в репозитории

| Файл | Описание |
|------|----------|
| `SDA.1.0.15/maFiles/76561199113719186.maFile` | Данные Steam Guard |
| `steam-master/steam/guard.py` | Библиотека для генерации кодов |
| `steam-master/steam/webauth.py` | Авторизация в Steam |
| `.kiro/specs/rust-p2p-trading-bot/requirements.md` | Требования проекта |
| `.kiro/specs/rust-p2p-trading-bot/design.md` | Техническое проектирование |
| `.kiro/specs/rust-p2p-trading-bot/tasks.md` | Задачи реализации |

---

## 🚀 Порядок реализации

### Фаза 1: Базовая инфраструктура
1. Создать структуру папок
2. Настроить конфигурацию
3. **Steam Guard модуль** (КРИТИЧНО!)

### Фаза 2: API интеграции
4. Pulse API
5. DMarket API

### Фаза 3: Веб-автоматизация
6. Loot.Farm (Playwright)
7. TradeIt.gg (Playwright)

### Фаза 4: Торговая логика
8. Trading Engine

### Фаза 5: Telegram бот
9. Управление через Telegram

### Фаза 6: Тестирование
10. Тест 1 круга

---

## ⚠️ Важные замечания

1. **Steam Guard** - без этого модуля НИЧЕГО не работает. Все трейды требуют подтверждения.

2. **Спред, а не цена** - ищем предмет с НАИБОЛЬШИМ спредом, а не просто дешевый или дорогой.

3. **Overstock** - проверять наличие у ботов перед покупкой/обменом.

4. **Комиссии** - учитывать комиссии площадок (3-5%).

5. **Токены Pulse** - экономить! 10000 токенов = $10.

6. **Rust** - в этой игре НЕТ трейдбана на предметах.

---

## 📞 Контакты для помощи

- Steam API: https://steamapi.xpaw.me/
- DMarket API: https://docs.dmarket.com/
- Pulse API: https://tradeon.gitbook.io/tradeon-api/
- Loot.Farm: https://loot.farm/ru/about.html
