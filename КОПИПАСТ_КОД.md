# üìã –ö–û–ü–ò–ü–ê–°–¢ –ö–û–î - –ë–´–°–¢–†–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

**–ì–æ—Ç–æ–≤—ã–π –∫–æ–¥ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –≤—Å—Ç–∞–≤–∫–∏**

---

## üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï #1: NoneType –≤ pulse_api.py

### –§–∞–π–ª: `rust-p2p-bot/src/pulse_api.py`

**–ù–∞–π—Ç–∏ —Å—Ç—Ä–æ–∫—É ~150 (–≤ —Ñ—É–Ω–∫—Ü–∏–∏ `compare_tables()`):**

```python
for item in data:
    if not item:
        continue
        
    first_info = item.get('firstMarketInfo') or {}
    second_info = item.get('secondMarketInfo') or {}
    
    buy_price = first_info.get('priceUsd', 0) or 0
    sell_price = second_info.get('priceUsd', 0) or 0
```

**–ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞:**

```python
for item in data:
    if not item:
        continue
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ None –¥–ª—è firstMarketInfo
    first_info = item.get('firstMarketInfo')
    if first_info is None:
        continue
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ None –¥–ª—è secondMarketInfo
    second_info = item.get('secondMarketInfo')
    if second_info is None:
        continue
    
    buy_price = first_info.get('priceUsd', 0) or 0
    sell_price = second_info.get('priceUsd', 0) or 0
    
    # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –µ—Å–ª–∏ —Ü–µ–Ω—ã –Ω—É–ª–µ–≤—ã–µ
    if buy_price <= 0 or sell_price <= 0:
        continue
```

---

## üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï #2: –ê–ª–≥–æ—Ä–∏—Ç–º –≤ trading_logic.py

### –§–∞–π–ª: `rust-p2p-bot/src/trading_logic.py`

**–ù–∞–π—Ç–∏ —Ñ—É–Ω–∫—Ü–∏—é `find_best_deal()` (—Å—Ç—Ä–æ–∫–∞ ~100):**

**–£–î–ê–õ–ò–¢–¨ –í–°–Æ –§–£–ù–ö–¶–ò–Æ –∏ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞:**

```python
async def find_best_deal(self) -> Optional[Deal]:
    """
    –ü–æ–∏—Å–∫ –ª—É—á—à–µ–π —Å–¥–µ–ª–∫–∏ —á–µ—Ä–µ–∑ Pulse API.
    –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –í–°–ï –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –ø–ª–æ—â–∞–¥–æ–∫.
    
    Returns:
        Deal –∏–ª–∏ None
    """
    
    # –í—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏
    combinations = [
        ('TradeItTrade', 'Dmarket'),
        ('TradeItTrade', 'LootFarm'),
        ('Dmarket', 'TradeItTrade'),
        ('Dmarket', 'LootFarm'),
        ('LootFarm', 'TradeItTrade'),
        ('LootFarm', 'Dmarket'),
    ]
    
    best_deal = None
    max_spread = self.min_spread
    
    for source, target in combinations:
        logger.info(f"Checking {source} -> {target}...")
        
        try:
            # –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º —á–µ—Ä–µ–∑ Pulse API
            results = await self.pulse.compare_tables(
                first_market=source,
                second_market=target,
                min_price=self.min_price,
                max_price=self.max_price,
                take=20,
                exclude_overstock=True
            )
            
            for result in results:
                # –§–∏–ª—å—Ç—Ä—ã
                if result.first_market.is_overstock:
                    continue
                if result.second_market.is_overstock:
                    continue
                if result.first_market.count <= 0:
                    continue
                if result.spread_percent <= 0:
                    continue
                    
                # –ù–∞—à–ª–∏ –ª—É—á—à–∏–π —Å–ø—Ä–µ–¥?
                if result.spread_percent > max_spread:
                    max_spread = result.spread_percent
                    best_deal = Deal(
                        item_name=result.item_name,
                        source_market=source,
                        target_market=target,
                        buy_price=result.first_market.price_usd,
                        sell_price=result.second_market.price_usd,
                        spread_percent=result.spread_percent,
                        spread_usd=result.spread_usd
                    )
                    
        except Exception as e:
            logger.error(f"Error checking {source} -> {target}: {e}")
            continue
    
    if best_deal:
        logger.success(
            f"Best deal: {best_deal.item_name} "
            f"({best_deal.source_market} ${best_deal.buy_price:.2f} -> "
            f"{best_deal.target_market} ${best_deal.sell_price:.2f}, "
            f"+{best_deal.spread_percent:.1f}%)"
        )
        
        if self._on_deal_found:
            await self._on_deal_found(best_deal)
    else:
        logger.warning("No profitable deals found")
    
    return best_deal
```

---

## üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï #3: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è TradeIt –≤ execute_deal()

### –§–∞–π–ª: `rust-p2p-bot/src/trading_logic.py`

**–ù–∞–π—Ç–∏ —Ñ—É–Ω–∫—Ü–∏—é `execute_deal()` (—Å—Ç—Ä–æ–∫–∞ ~200):**

**–í –±–ª–æ–∫–µ –ø–æ–∫—É–ø–∫–∏ (–ø–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏ "# 1. –ü–æ–∫—É–ø–∫–∞ –Ω–∞ source –ø–ª–æ—â–∞–¥–∫–µ"):**

**–ù–∞–π—Ç–∏:**
```python
if deal.source_market == Market.DMARKET.value:
    buy_trade_id = await self._buy_on_dmarket(deal.item_name, deal.buy_price * 1.05)
elif deal.source_market == Market.LOOTFARM.value:
    buy_trade_id = await self._buy_on_lootfarm(deal.item_name, deal.buy_price * 1.05)
```

**–î–æ–±–∞–≤–∏—Ç—å –ü–û–°–õ–ï:**
```python
elif deal.source_market == Market.TRADEIT.value or deal.source_market == 'TradeItTrade':
    buy_trade_id = await self._buy_on_tradeit(deal.item_name, deal.buy_price * 1.05)
```

**–í –±–ª–æ–∫–µ –ø—Ä–æ–¥–∞–∂–∏ (–ø–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏ "# 4. –ü—Ä–æ–¥–∞–∂–∞ –Ω–∞ target –ø–ª–æ—â–∞–¥–∫–µ"):**

**–ù–∞–π—Ç–∏:**
```python
if deal.target_market == Market.DMARKET.value:
    sell_trade_id = await self._sell_on_dmarket(deal.item_name, deal.sell_price * 0.95)
elif deal.target_market == Market.LOOTFARM.value:
    sell_trade_id = await self._sell_on_lootfarm(deal.item_name, deal.sell_price * 0.95)
```

**–î–æ–±–∞–≤–∏—Ç—å –ü–û–°–õ–ï:**
```python
elif deal.target_market == Market.TRADEIT.value or deal.target_market == 'TradeItTrade':
    sell_trade_id = await self._sell_on_tradeit(deal.item_name, deal.sell_price * 0.95)
```

---

## üì¶ –ö–û–ú–ê–ù–î–´ –£–°–¢–ê–ù–û–í–ö–ò

### –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```bash
cd rust-p2p-bot
pip install selenium webdriver-manager aiogram
pip freeze > requirements.txt
```

### –°–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É –¥–ª—è ChromeDriver:
```bash
mkdir drivers
```

---

## üß™ –¢–ï–°–¢–û–í–´–ô –§–ê–ô–õ: test_tradeit.py

### –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª: `rust-p2p-bot/test_tradeit.py`

```python
"""
–¢–µ—Å—Ç TradeIt.gg –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
"""

import asyncio
from src.tradeit import TradeItBot

async def test():
    print("=" * 60)
    print("–¢–ï–°–¢ TRADEIT.GG –ò–ù–¢–ï–ì–†–ê–¶–ò–ò")
    print("=" * 60)
    
    bot = TradeItBot()
    
    try:
        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±—Ä–∞—É–∑–µ—Ä–∞
        print("\n1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±—Ä–∞—É–∑–µ—Ä–∞...")
        await bot.init_browser(headless=False)  # –° GUI –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
        print("‚úÖ –ë—Ä–∞—É–∑–µ—Ä –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω")
        
        # –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
        print("\n2. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è...")
        success = await bot.login()
        if success:
            print("‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!")
        else:
            print("‚ùå –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–µ —É–¥–∞–ª–∞—Å—å")
            return
        
        # –ë–∞–ª–∞–Ω—Å
        print("\n3. –ü–æ–ª—É—á–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞...")
        balance = await bot.get_balance()
        print(f"‚úÖ –ë–∞–ª–∞–Ω—Å: ${balance:.2f}")
        
        # –ü–æ–∏—Å–∫ –ø—Ä–µ–¥–º–µ—Ç–∞
        print("\n4. –ü–æ–∏—Å–∫ –ø—Ä–µ–¥–º–µ—Ç–∞ 'AK-47'...")
        item = await bot.search_item("AK-47")
        if item:
            print(f"‚úÖ –ù–∞–π–¥–µ–Ω: {item['name']} - ${item['price']:.2f}")
            print(f"   –°–æ—Å—Ç–æ—è–Ω–∏–µ: {item['condition']}")
            print(f"   –í –Ω–∞–ª–∏—á–∏–∏: {item['stock']} —à—Ç")
        else:
            print("‚ùå –ü—Ä–µ–¥–º–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω")
        
        # –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å
        print("\n5. –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è...")
        inventory = await bot.get_inventory()
        print(f"‚úÖ –í –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ {len(inventory)} –ø—Ä–µ–¥–º–µ—Ç–æ–≤")
        if inventory:
            print("   –ü–µ—Ä–≤—ã–µ 3 –ø—Ä–µ–¥–º–µ—Ç–∞:")
            for i, item in enumerate(inventory[:3], 1):
                print(f"   {i}. {item['name']} - ${item['price']:.2f}")
        
        print("\n" + "=" * 60)
        print("‚úÖ –í–°–ï –¢–ï–°–¢–´ –ü–†–û–ô–î–ï–ù–´!")
        print("=" * 60)
        
    except Exception as e:
        print(f"\n‚ùå –û–®–ò–ë–ö–ê: {e}")
        import traceback
        traceback.print_exc()
        
    finally:
        print("\n6. –ó–∞–∫—Ä—ã—Ç–∏–µ –±—Ä–∞—É–∑–µ—Ä–∞...")
        await bot.close()
        print("‚úÖ –ë—Ä–∞—É–∑–µ—Ä –∑–∞–∫—Ä—ã—Ç")

if __name__ == '__main__':
    asyncio.run(test())
```

**–ó–∞–ø—É—Å—Ç–∏—Ç—å:**
```bash
python test_tradeit.py
```

---

## üß™ –¢–ï–°–¢–û–í–´–ô –§–ê–ô–õ: test_algorithm.py

### –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª: `rust-p2p-bot/test_algorithm.py`

```python
"""
–¢–µ—Å—Ç –Ω–æ–≤–æ–≥–æ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –ø–æ–∏—Å–∫–∞ —Å–ø—Ä–µ–¥–∞
"""

import asyncio
import json
from src.pulse_api import PulseAPI

async def test():
    print("=" * 60)
    print("–¢–ï–°–¢ –ê–õ–ì–û–†–ò–¢–ú–ê –ü–û–ò–°–ö–ê –°–ü–†–ï–î–ê")
    print("=" * 60)
    
    # –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫
    with open('config/settings.json', 'r') as f:
        settings = json.load(f)
    
    pulse = PulseAPI(settings['pulse']['api_key'])
    
    try:
        # –í—Å–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏
        combinations = [
            ('TradeItTrade', 'Dmarket'),
            ('TradeItTrade', 'LootFarm'),
            ('Dmarket', 'TradeItTrade'),
            ('Dmarket', 'LootFarm'),
            ('LootFarm', 'TradeItTrade'),
            ('LootFarm', 'Dmarket'),
        ]
        
        best_spread = 0
        best_deal = None
        
        for source, target in combinations:
            print(f"\nüîç –ü—Ä–æ–≤–µ—Ä—è–µ–º: {source} -> {target}")
            
            results = await pulse.compare_tables(
                first_market=source,
                second_market=target,
                min_price=0.50,
                max_price=3.00,
                take=10,
                exclude_overstock=True
            )
            
            print(f"   –ù–∞–π–¥–µ–Ω–æ –ø—Ä–µ–¥–º–µ—Ç–æ–≤: {len(results)}")
            
            for result in results[:3]:  # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ø-3
                if result.spread_percent > best_spread:
                    best_spread = result.spread_percent
                    best_deal = result
                
                print(f"   ‚Ä¢ {result.item_name}")
                print(f"     ${result.first_market.price_usd:.2f} -> ${result.second_market.price_usd:.2f}")
                print(f"     –°–ø—Ä–µ–¥: +{result.spread_percent:.1f}%")
        
        print("\n" + "=" * 60)
        if best_deal:
            print("üèÜ –õ–£–ß–®–ò–ô –°–ü–†–ï–î:")
            print(f"   –ü—Ä–µ–¥–º–µ—Ç: {best_deal.item_name}")
            print(f"   –ö—É–ø–∏—Ç—å: ${best_deal.first_market.price_usd:.2f}")
            print(f"   –ü—Ä–æ–¥–∞—Ç—å: ${best_deal.second_market.price_usd:.2f}")
            print(f"   –°–ø—Ä–µ–¥: +{best_deal.spread_percent:.1f}%")
            print(f"   –ü—Ä–∏–±—ã–ª—å: ${best_deal.spread_usd:.2f}")
        else:
            print("‚ùå –í—ã–≥–æ–¥–Ω—ã—Ö —Å–ø—Ä–µ–¥–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ")
        print("=" * 60)
        
        print(f"\nüìä –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ —Ç–æ–∫–µ–Ω–æ–≤: {pulse.get_tokens_used()}")
        
    finally:
        await pulse.close()

if __name__ == '__main__':
    asyncio.run(test())
```

**–ó–∞–ø—É—Å—Ç–∏—Ç—å:**
```bash
python test_algorithm.py
```

---

## üìù –ë–´–°–¢–†–´–ô –ß–ï–ö–õ–ò–°–¢

### –®–∞–≥ 1: –ò—Å–ø—Ä–∞–≤–∏—Ç—å NoneType
- [ ] –û—Ç–∫—Ä—ã—Ç—å `src/pulse_api.py`
- [ ] –ù–∞–π—Ç–∏ —Ñ—É–Ω–∫—Ü–∏—é `compare_tables()`
- [ ] –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ "–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï #1"
- [ ] –°–æ—Ö—Ä–∞–Ω–∏—Ç—å

### –®–∞–≥ 2: –ü–µ—Ä–µ–¥–µ–ª–∞—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º
- [ ] –û—Ç–∫—Ä—ã—Ç—å `src/trading_logic.py`
- [ ] –ù–∞–π—Ç–∏ —Ñ—É–Ω–∫—Ü–∏—é `find_best_deal()`
- [ ] –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ "–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï #2"
- [ ] –°–æ—Ö—Ä–∞–Ω–∏—Ç—å

### –®–∞–≥ 3: –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å TradeIt
- [ ] –û—Ç–∫—Ä—ã—Ç—å `src/trading_logic.py`
- [ ] –ù–∞–π—Ç–∏ —Ñ—É–Ω–∫—Ü–∏—é `execute_deal()`
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∫–æ–¥ –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ "–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï #3"
- [ ] –°–æ—Ö—Ä–∞–Ω–∏—Ç—å

### –®–∞–≥ 4: –°–æ–∑–¥–∞—Ç—å TradeIt –º–æ–¥—É–ª—å
- [ ] –û—Ç–∫—Ä—ã—Ç—å `TRADEIT_GG_GUIDE.md`
- [ ] –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –í–ï–°–¨ –∫–æ–¥
- [ ] –í—Å—Ç–∞–≤–∏—Ç—å –≤ `src/tradeit.py`
- [ ] –ó–∞–ø–æ–ª–Ω–∏—Ç—å LOGIN_EMAIL –∏ LOGIN_PASSWORD

### –®–∞–≥ 5: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- [ ] `pip install selenium webdriver-manager aiogram`
- [ ] `pip freeze > requirements.txt`
- [ ] –°–∫–∞—á–∞—Ç—å ChromeDriver –≤ `drivers/`

### –®–∞–≥ 6: –¢–µ—Å—Ç—ã
- [ ] –°–æ–∑–¥–∞—Ç—å `test_tradeit.py`
- [ ] –°–æ–∑–¥–∞—Ç—å `test_algorithm.py`
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å –æ–±–∞ —Ç–µ—Å—Ç–∞

---

## ‚úÖ –û–ñ–ò–î–ê–ï–ú–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è NoneType:
```bash
python main.py --test-trade
# ‚úÖ –ù–∞—Ö–æ–¥—è—Ç—Å—è —Å–ø—Ä–µ–¥—ã –ë–ï–ó –æ—à–∏–±–æ–∫
```

### –ü–æ—Å–ª–µ –ø–µ—Ä–µ–¥–µ–ª–∫–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–∞:
```bash
python test_algorithm.py
# üèÜ –õ–£–ß–®–ò–ô –°–ü–†–ï–î:
#    –ü—Ä–µ–¥–º–µ—Ç: Ace Door
#    –°–ø—Ä–µ–¥: +46.7%
```

### –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è TradeIt:
```bash
python test_tradeit.py
# ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!
# ‚úÖ –ë–∞–ª–∞–Ω—Å: $28.00
# ‚úÖ –ù–∞–π–¥–µ–Ω: AK-47 Victoria - $68.80
```

---

## üìû –°–ü–†–ê–í–ö–ê

**–ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:** `README_–ò–¢–û–ì–û–í–´–ô.md`  
**–ü–æ—à–∞–≥–æ–≤—ã–π –≥–∞–π–¥:** `–§–ê–ó–ê_1_–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï.md`  
**–°–ø–∏—Å–æ–∫ –æ—à–∏–±–æ–∫:** `–§–ê–ó–ê_1_–û–®–ò–ë–ö–ò.md`

**–£–¥–∞—á–∏! üöÄ**
