# P2P Trading Bot для Rust скинов - Требования

## Обзор проекта

Автоматизированный бот для P2P трейдинга скинов игры Rust между площадками:
- **TradeIt.gg** (основной баланс ~$28)
- **DMarket** (баланс ~$1.10)
- **Loot.Farm** (баланс $0)

Бот использует таблицу **Pulse TradeOn** для анализа спреда цен и автоматически:
1. Находит предметы с наибольшим спредом между площадками
2. Покупает/обменивает на одной площадке
3. Продает/обменивает на другой с профитом
4. Автоматически подтверждает все трейды через Steam Guard

## Ключевые данные

### API ключи
- **Pulse API**: `btpx0x70uq4tqqouw82zsgo4th8bbvc2` (10000 токенов = $10)
- **DMarket Public Key**: `29e8f8de3f4c9fd27a372b310935f1894ed2f649076308b4a65e209c8a920463`
- **DMarket Private Key**: `117a339181a1a7e2beaee49b6a82b38ad022461fa4cf7cea60b9f30d068978c429e8f8de3f4c9fd27a372b310935f1894ed2f649076308b4a65e209c8a920463`
- **Steam API Key**: `A1212401D06E9D87970B68F57BDA259`

### Steam аккаунт
- **Username**: `mz1r0y0viv2blnxo`
- **SteamID**: `76561199113719186`
- **shared_secret**: `4jPw7S9tfkaHtrxiGEQAQtMAPv0=`
- **identity_secret**: `OXVdKtNH+SnnTjYycJU/n47O1Wk=`
- **device_id**: `android:8f86487a-e48b-4bab-b5a0-93cd9e53e840`

### Telegram Bot
- **Token**: `8441168945:AAFjcsas9wObkYwh2TQhLaekj5agix2aBCk`

---

## User Stories

### US-1: Анализ спреда цен
**Как** трейдер,
**Я хочу** автоматически находить предметы с наибольшим спредом цен между площадками,
**Чтобы** максимизировать прибыль с каждого круга.

#### Критерии приемки:
- 1.1 Бот использует Pulse API для сравнения цен между площадками
- 1.2 Сравниваются ВСЕ комбинации: TradeIt↔DMarket, TradeIt↔LootFarm, DMarket↔LootFarm
- 1.3 Фильтруются предметы без overstock (есть в наличии у ботов)
- 1.4 Минимальная цена предмета: $0.50, максимум: $3.00 (настраивается)
- 1.5 Выбирается предмет с НАИБОЛЬШИМ спредом, а не просто дешевый/дорогой
- 1.6 Экономное использование токенов Pulse (приоритет CompareTables - 2 токена)

### US-2: Динамический выбор площадки
**Как** трейдер,
**Я хочу** чтобы бот сам определял с какой площадки начинать круг,
**Чтобы** использовать баланс там, где он есть.

#### Критерии приемки:
- 2.1 Бот проверяет баланс на всех площадках
- 2.2 Начинает круг с площадки где есть достаточный баланс
- 2.3 Если баланс есть на нескольких - выбирает лучший спред
- 2.4 Динамически меняет направление круга для максимизации профита

### US-3: Покупка на DMarket
**Как** трейдер,
**Я хочу** автоматически покупать скины на DMarket,
**Чтобы** не делать это вручную.

#### Критерии приемки:
- 3.1 Бот авторизуется через DMarket API
- 3.2 Находит предмет по имени из таблицы Pulse
- 3.3 Покупает предмет через API
- 3.4 Выводит предмет в Steam инвентарь
- 3.5 Автоматически подтверждает трейд через Steam Guard

### US-4: Обмен на Loot.Farm
**Как** трейдер,
**Я хочу** автоматически обменивать скины на Loot.Farm,
**Чтобы** получать более дорогие предметы.

#### Критерии приемки:
- 4.1 Бот работает через веб-интеграцию (Selenium/Playwright)
- 4.2 Обновляет инвентарь на сайте
- 4.3 Находит предмет для обмена по поиску
- 4.4 Выбирает предмет который дороже на DMarket (по таблице)
- 4.5 Создает обмен и подтверждает через Steam Guard
- 4.6 Проверяет наличие у ботов через JSON API: https://loot.farm/fullpriceRUST.json

### US-5: Обмен/Покупка на TradeIt.gg
**Как** трейдер,
**Я хочу** автоматически работать с TradeIt.gg,
**Чтобы** использовать основной баланс ($28).

#### Критерии приемки:
- 5.1 Бот работает через веб-интеграцию (нет публичного API)
- 5.2 Авторизуется через Steam
- 5.3 Находит предметы по поиску
- 5.4 Создает обмен/покупку
- 5.5 Выводит в Steam инвентарь
- 5.6 Автоматически подтверждает трейд

### US-6: Автоподтверждение трейдов
**Как** трейдер,
**Я хочу** чтобы ВСЕ трейды подтверждались автоматически,
**Чтобы** не делать это вручную через SDA.

#### Критерии приемки:
- 6.1 Используется библиотека steam-master (ValvePython/steam)
- 6.2 Генерация кодов через shared_secret
- 6.3 Подтверждение через identity_secret
- 6.4 Периодическая проверка новых подтверждений (каждые 5-10 сек)
- 6.5 Автоматическое подтверждение ВСЕХ трейдов от ботов площадок
- 6.6 Логирование всех подтверждений

### US-7: Telegram бот управления
**Как** пользователь,
**Я хочу** управлять ботом через Telegram,
**Чтобы** следить за работой и настраивать параметры.

#### Критерии приемки:
- 7.1 Inline кнопки (не команды)
- 7.2 Кнопки: Баланс и режим, Остановить/Запустить торговлю, Статистика, Настройки
- 7.3 Авто 24/7 режим, Обновить, Логи, Тест сделки
- 7.4 Кнопка Steam (информация об аккаунте), Помощь
- 7.5 Выключить бота
- 7.6 Понятные логи в реальном времени
- 7.7 Уведомления о сделках автоматически
- 7.8 Настройка минимальной/максимальной цены
- 7.9 Инструкция где залить деньги перед стартом

### US-8: Безопасность и надежность
**Как** пользователь,
**Я хочу** чтобы бот работал надежно и безопасно,
**Чтобы** не потерять деньги и аккаунт.

#### Критерии приемки:
- 8.1 Возможность загрузить новый maFile если аккаунт забанен
- 8.2 Логирование всех операций
- 8.3 Обработка ошибок без падения бота
- 8.4 Проверка статуса предметов (overstock, unstable)
- 8.5 Тестовый режим (1 круг) перед полным запуском

---

## Технические требования

### Стек технологий
- **Python 3.10+**
- **steam** библиотека (ValvePython/steam) - для Steam Guard
- **requests** - для API запросов
- **playwright** или **selenium** - для веб-автоматизации
- **python-telegram-bot** - для Telegram бота
- **asyncio** - для асинхронной работы

### Структура проекта
```
rust-p2p-bot/
├── config/
│   ├── settings.json      # Настройки бота
│   └── mafile.json        # Данные Steam Guard
├── src/
│   ├── steam_guard.py     # Автоподтверждение трейдов
│   ├── pulse_api.py       # Работа с Pulse API
│   ├── dmarket_api.py     # Работа с DMarket API
│   ├── lootfarm.py        # Веб-автоматизация Loot.Farm
│   ├── tradeit.py         # Веб-автоматизация TradeIt.gg
│   ├── trading_logic.py   # Основная логика трейдинга
│   └── telegram_bot.py    # Telegram бот
├── logs/                  # Логи операций
├── main.py               # Точка входа
└── requirements.txt      # Зависимости
```

### Ограничения
- Rust App ID: 252490
- Комиссия Loot.Farm: 3-5%
- Комиссия DMarket: ~5%
- Лимит запросов Pulse: экономить токены
- Steam трейд-лок: в Rust нет трейдбана на предметах

---

## Логика работы (упрощенная схема)

```
1. СТАРТ
   ├─ Проверить балансы на всех площадках
   ├─ Определить площадку с балансом
   └─ Запросить Pulse API для анализа спреда

2. АНАЛИЗ СПРЕДА
   ├─ CompareTables: площадка1 vs площадка2
   ├─ Фильтр: цена $0.50-$3.00, без overstock
   ├─ Сортировка по СПРЕДУ (не по цене!)
   └─ Выбор лучшего предмета

3. ПОКУПКА/ОБМЕН
   ├─ Если DMarket: API покупка → вывод в Steam
   ├─ Если LootFarm: Веб обмен → подтверждение
   └─ Если TradeIt: Веб покупка → вывод в Steam

4. АВТОПОДТВЕРЖДЕНИЕ
   ├─ Мониторинг confirmations через Steam API
   ├─ Генерация confirmation_key
   └─ Автоматическое подтверждение

5. ПРОДАЖА/ОБМЕН НА ДРУГОЙ ПЛОЩАДКЕ
   ├─ Ожидание появления в инвентаре
   ├─ Продажа/обмен по цене из таблицы
   └─ Подтверждение трейда

6. ПРОФИТ
   ├─ Логирование результата
   ├─ Уведомление в Telegram
   └─ Повтор цикла
```

---

## Приоритеты реализации

1. **Критично**: Steam Guard автоподтверждение (US-6)
2. **Критично**: Pulse API интеграция (US-1)
3. **Высокий**: DMarket API (US-3)
4. **Высокий**: Telegram бот (US-7)
5. **Средний**: Loot.Farm веб-автоматизация (US-4)
6. **Средний**: TradeIt.gg веб-автоматизация (US-5)
7. **Низкий**: Расширенные настройки (US-2, US-8)
